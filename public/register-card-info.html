<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カード利用者決済情報トークン取得</title>
  <!-- サービス提供時に案内されるURLに差し替え -->
  <script type="text/javascript" src="https://stbfep.sps-system.com/tds2/js/com_sbps_system_tds2infotoken.js"></script>
</head>
<body>
  <h1>3Dセキュア トークン取得</h1>

  <form id="frm" method="POST" action="/your-backend/handle-token">
    <dl>
      <dt>マーチャントID</dt>
      <dd><input type="text" id="merchant_id" name="merchant_id" value="12345"></dd>

      <dt>サービスID</dt>
      <dd><input type="text" id="service_id" name="service_id" value="001"></dd>

      <dt>姓（請求先）</dt>
      <dd><input type="text" id="billingLastName" name="billingLastName" value="山田"></dd>

      <dt>名（請求先）</dt>
      <dd><input type="text" id="billingFirstName" name="billingFirstName" value="太郎"></dd>

      <dt>郵便番号</dt>
      <dd><input type="text" id="billingPostalCode" name="billingPostalCode" value="1234567"></dd>

      <dt>市区町村</dt>
      <dd><input type="text" id="billingCity" name="billingCity" value="港区"></dd>

      <dt>住所1</dt>
      <dd><input type="text" id="billingAddress1" name="billingAddress1" value="芝公園1-1-1"></dd>

      <dt>電話番号</dt>
      <dd><input type="text" id="billingPhone" name="billingPhone" value="0312345678"></dd>

      <dt>メールアドレス</dt>
      <dd><input type="email" id="email" name="email" value="sample@example.com"></dd>
    </dl>

    <hr>

    <dl>
      <dt>取得トークン</dt>
      <dd><input type="text" id="token" name="token" readonly></dd>

      <dt>トークンキー</dt>
      <dd><input type="text" id="tokenKey" name="tokenKey" readonly></dd>
    </dl>

    <button type="button" onclick="doSubmit()">トークン取得</button>
    <button type="reset">リセット</button>
  </form>

  <script>
    function doSubmit() {
      com_sbps_system_tds2.generateToken({
        merchantId: document.getElementById('merchant_id').value,
        serviceId: document.getElementById('service_id').value,
        billingLastName: document.getElementById('billingLastName').value,
        billingFirstName: document.getElementById('billingFirstName').value,
        billingPostalCode: document.getElementById('billingPostalCode').value,
        billingCity: document.getElementById('billingCity').value,
        billingAddress1: document.getElementById('billingAddress1').value,
        billingPhone: document.getElementById('billingPhone').value,
        email: document.getElementById('email').value
      }, afterGenerateToken);
    }

    function afterGenerateToken(response) {
      if (response.result === "OK") {
        const token = response.tokenResponse.tds2infoToken;
        const tokenKey = response.tokenResponse.tds2infoTokenKey;

        document.getElementById('token').value = token;
        document.getElementById('tokenKey').value = tokenKey;

        if (window.confirm("トークン取得に成功しました。決済処理に進みますか？")) {
          // Vueアプリ側バックエンドなどへ送信する
          document.getElementById('frm').submit();
        } else {
          alert("キャンセルされました。");
        }
      } else {
        alert("トークン取得に失敗しました: " + response.result);
      }
    }
  </script>
</body>
</html>
